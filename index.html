<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OxcyShop - Panel de Control</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',sans-serif;background:#0f0f0f;color:#fff;padding:20px}
.navbar{background:#1a1a1a;padding:20px;border-bottom:2px solid #667eea;margin-bottom:30px;border-radius:8px;display:flex;justify-content:space-between;align-items:center}
.navbar h1{color:#667eea;margin:0}
.navbar button{background:#c33;color:white;border:none;padding:10px 20px;border-radius:5px;cursor:pointer;font-weight:bold}
.container{max-width:1200px;margin:0 auto}
.tabs{display:flex;gap:10px;margin-bottom:20px;border-bottom:2px solid #333;padding-bottom:10px}
.tab{padding:10px 20px;background:#1a1a1a;border:none;color:#888;cursor:pointer;border-radius:5px 5px 0 0;font-weight:bold}
.tab.active{background:#667eea;color:white}
.section{display:none;background:#1a1a1a;padding:20px;border-radius:8px;border:1px solid #333}
.section.active{display:block}
table{width:100%;border-collapse:collapse;margin-top:15px}
th{background:#2a2a2a;padding:10px;text-align:left;color:#667eea;border-bottom:2px solid #444}
td{padding:10px;border-bottom:1px solid #333}
button{padding:8px 15px;margin:2px;border:none;border-radius:4px;cursor:pointer;font-weight:bold}
.btn-primary{background:#667eea;color:white;padding:10px 20px}
.btn-delete{background:#e24a4a;color:white;font-size:12px}
.btn-ban{background:#e2964a;color:white;font-size:12px}
.msg{padding:15px;margin-bottom:15px;border-radius:5px;display:none}
.msg.show{display:block}
.msg.success{background:#2d5016;color:#7fd321;border-left:4px solid #7fd321}
.msg.error{background:#501616;color:#ff6b6b;border-left:4px solid #ff6b6b}
input{padding:8px;background:#2a2a2a;border:1px solid #444;color:white;border-radius:4px;margin:5px 0}
code{background:#2a2a2a;padding:2px 6px;border-radius:3px;color:#7fd321;font-size:12px}
.form{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:20px}
.form input{flex:1;min-width:150px}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
@keyframes slideIn{from{opacity:0;transform:translateX(-20px)}to{opacity:1;transform:translateX(0)}}
@keyframes pulse{0%{box-shadow:0 0 0 0 rgba(102,126,234,0.7)}70%{box-shadow:0 0 0 10px rgba(102,126,234,0)}100%{box-shadow:0 0 0 0 rgba(102,126,234,0)}}
@keyframes glow{0%{text-shadow:0 0 5px #667eea}50%{text-shadow:0 0 20px #667eea}100%{text-shadow:0 0 5px #667eea}}
.navbar h1{animation:glow 2s ease-in-out infinite}
.section{animation:fadeIn 0.4s ease-out}
.tab{transition:all 0.3s cubic-bezier(0.25,0.46,0.45,0.94)}
.tab:hover{background:#2a2a2a;color:#667eea;transform:translateY(-2px)}
.btn-primary{animation:slideIn 0.3s ease-out;transition:all 0.3s ease}
.btn-primary:hover{box-shadow:0 5px 15px rgba(102,126,234,0.4);transform:translateY(-2px);animation:pulse 1s infinite}
.btn-delete{transition:all 0.3s ease}
.btn-delete:hover{background:#ff4444;box-shadow:0 3px 8px rgba(255,68,68,0.3);transform:scale(1.05)}
.btn-ban{transition:all 0.3s ease}
.btn-ban:hover{background:#ff7d4a;box-shadow:0 3px 8px rgba(255,125,74,0.3);transform:scale(1.05)}
table{animation:fadeIn 0.5s ease-out}
tr{transition:all 0.2s ease}
tr:hover{background:#2a2a2a;box-shadow:inset 0 0 10px rgba(102,126,234,0.1)}
.msg{animation:slideIn 0.3s ease-out}
input{transition:all 0.3s ease;border-color:#667eea}
input:focus{outline:none;border-color:#7fd321;box-shadow:0 0 8px rgba(127,211,33,0.3)}
</style>
</head>
<body>

<div id="loginPanel" class="navbar" style="flex-direction:column;gap:20px;max-width:400px;margin:100px auto">
    <h1 style="width:100%;text-align:center">üîê Panel de Control</h1>
    <button onclick="doLogin()" class="btn-primary" style="width:100%;padding:15px;font-size:16px;font-weight:bold">‚Üó Entrar con Discord</button>
    <p style="text-align:center;color:#888;font-size:12px">Pr√≥ximamente: Google, GitHub y m√°s opciones</p>
    <div id="loginMsg" class="msg"></div>
</div>



<div id="dashPanel" style="display:none">
<div class="navbar">
    <h1>üîê <span id="appTitle">OxcyShop</span> - Panel de Control</h1>
    <div style="display:flex;gap:10px">
        <button onclick="location.reload()" style="background:#667eea;color:white;border:none;padding:10px 20px;border-radius:5px;cursor:pointer">Actualizar</button>
        <button onclick="doLogout()" style="background:#c33;color:white;border:none;padding:10px 20px;border-radius:5px;cursor:pointer">Salir</button>
    </div>
</div>

<div class="container">
    <div id="msg" class="msg"></div>

    <div class="tabs">
        <button class="tab active" onclick="tab('creds')">üîë Mis Credenciales</button>
        <button class="tab" onclick="tab('users')">üë• Usuarios</button>
        <button class="tab" onclick="tab('kill')">‚öîÔ∏è Kill Sesi√≥n</button>
        <button class="tab" onclick="tab('create')">‚ûï Crear Usuario</button>
        <button class="tab" onclick="tab('banned')">üö´ Baneados</button>
        <button class="tab" onclick="tab('hwid_resets')">‚öôÔ∏è Reset HWID</button>
        <button class="tab" onclick="tab('version')">üì¶ Versi√≥n</button>
    </div>

    <div id="creds" class="section active">
        <h2>üîë Mis Credenciales</h2>
        <div style="background:#2a2a2a;padding:20px;border-radius:8px;border:1px solid #667eea">
            <div style="margin-bottom:20px">
                <label style="display:block;margin-bottom:5px;color:#7fd321;font-weight:bold">Usuario:</label>
                <div style="display:flex;gap:10px;align-items:center">
                    <code id="userDisplay" style="flex:1;padding:10px;background:#1a1a1a;border-radius:4px">-</code>
                    <button class="btn-primary" onclick="copyToClipboard(this,'userDisplay')">Copiar</button>
                </div>
            </div>
            <div style="margin-bottom:20px">
                <label style="display:block;margin-bottom:5px;color:#7fd321;font-weight:bold">App Name:</label>
                <div style="display:flex;gap:10px;align-items:center">
                    <code id="appDisplay" style="flex:1;padding:10px;background:#1a1a1a;border-radius:4px">-</code>
                    <button class="btn-primary" onclick="copyToClipboard(this,'appDisplay')">Copiar</button>
                </div>
            </div>
            <div style="margin-bottom:20px">
                <label style="display:block;margin-bottom:5px;color:#7fd321;font-weight:bold">Owner ID:</label>
                <div style="display:flex;gap:10px;align-items:center">
                    <code id="ownerDisplay" style="flex:1;padding:10px;background:#1a1a1a;border-radius:4px;word-break:break-all">-</code>
                    <button class="btn-primary" onclick="copyToClipboard(this,'ownerDisplay')">Copiar</button>
                </div>
            </div>
            <div>
                <label style="display:block;margin-bottom:5px;color:#7fd321;font-weight:bold">Secret:</label>
                <div style="display:flex;gap:10px;align-items:center">
                    <code id="secretDisplay" style="flex:1;padding:10px;background:#1a1a1a;border-radius:4px;word-break:break-all">-</code>
                    <button class="btn-primary" onclick="copyToClipboard(this,'secretDisplay')">Copiar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="users" class="section">
        <h2>üë• Usuarios</h2>
        <table>
            <thead><tr><th>ID</th><th>Usuario</th><th>HWID</th><th>IP</th><th>√öltimo Login</th><th>Estado</th><th>Acciones</th></tr></thead>
            <tbody id="usersTable"></tbody>
        </table>
    </div>

    <div id="kill" class="section">
        <h2>‚öîÔ∏è Forzar Cierre de Sesi√≥n</h2>
        <div class="form">
            <input type="text" id="killUsername" placeholder="Username a matar">
            <button class="btn-delete" onclick="killSession()">Matar Sesi√≥n</button>
        </div>
        <p style="color:#7fd321;font-size:12px">‚ö†Ô∏è Bloquear√° el usuario y cerrar√° todos sus EXE abiertos.</p>
    </div>

    <div id="hwid_resets" class="section">
        <h2>‚öôÔ∏è Reset HWID Pendientes</h2>
        <p style="color:#7fd321;margin-bottom:15px">Solicitudes de reset de hardware:</p>
        <table>
            <thead><tr><th>ID</th><th>Usuario</th><th>HWID Anterior</th><th>Acciones</th></tr></thead>
            <tbody id="hwidResetsTable"></tbody>
        </table>
    </div>

    <div id="licenses" class="section">
        <h2>Licencias</h2>
        <button class="btn-primary" onclick="genLic()">Generar Licencia</button>
        <table>
            <thead><tr><th>ID</th><th>Clave</th><th>HWID</th><th>Vence</th><th>Estado</th><th>Acci√≥n</th></tr></thead>
            <tbody id="licTable"></tbody>
        </table>
    </div>

    <div id="ips" class="section">
        <h2>üö´ Baneados (IPs y HWIDs)</h2>
        <div class="form">
            <input type="text" id="banIP" placeholder="IP" style="width:150px">
            <input type="text" id="banHWID" placeholder="HWID" style="width:150px">
            <input type="text" id="banReason" placeholder="Raz√≥n" style="width:150px">
            <button class="btn-primary" onclick="banIP()">Banear IP</button>
            <button class="btn-primary" onclick="banHWID()">Banear HWID</button>
        </div>
        <table>
            <thead><tr><th>IP</th><th>HWID</th><th>Raz√≥n</th><th>Fecha</th><th>Acci√≥n</th></tr></thead>
            <tbody id="banTable"></tbody>
        </table>
    </div>

    <div id="create" class="section">
        <h2>Crear Usuario</h2>
        <input type="text" id="newUser" placeholder="usuario">
        <input type="password" id="newPass" placeholder="contrase√±a">
        <button class="btn-primary" onclick="createUser()">Crear</button>
    </div>

    <div id="banned" class="section">
        <h2>üö´ Hardware/IP Baneados</h2>
        <table>
            <thead><tr><th>ID</th><th>Tipo</th><th>Valor</th><th>Raz√≥n</th><th>Fecha</th><th>Acci√≥n</th></tr></thead>
            <tbody id="bannedTable"></tbody>
        </table>
    </div>

    <div id="version" class="section">
        <h2>üì¶ Versi√≥n del Cliente</h2>
        <div style="background:#2a2a2a;padding:20px;border-radius:8px;border:1px solid #667eea">
            <div style="margin-bottom:20px">
                <label style="display:block;margin-bottom:5px;color:#7fd321;font-weight:bold">Versi√≥n Requerida:</label>
                <div style="display:flex;gap:10px;align-items:center">
                    <input type="text" id="versionInput" placeholder="ej: 1.2" style="flex:1">
                    <button class="btn-primary" onclick="setVersion()">Actualizar</button>
                </div>
            </div>
            <div>
                <label style="display:block;margin-bottom:5px;color:#7fd321;font-weight:bold">Versi√≥n Actual:</label>
                <code id="currentVersionDisplay" style="padding:10px;background:#1a1a1a;border-radius:4px;display:inline-block">-</code>
            </div>
            <p style="color:#999;margin-top:15px;font-size:12px">‚ö†Ô∏è Al cambiar la versi√≥n requerida, todos tus usuarios deber√°n actualizar a esa versi√≥n para poder usar sus cuentas.</p>
        </div>
    </div>
</div>
</div>

<script>
const API='http://localhost:8000/api';
let currentUser='';
let currentOwnerID='';
let currentAppName='';
let currentSecret='';

let lastTab='creds';
function tab(t){
    document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
    document.getElementById(t).classList.add('active');
    event.target.classList.add('active');
    if(t==='users'||t==='version'||t==='banned'||t==='hwid_resets'){loadTab(t)}
    lastTab=t;
}
async function loadTab(t){
    try{
        if(t==='users'){
            const u=await fetch(`${API}/client/users/${currentOwnerID}?secret=${currentSecret}`);
            const ud=await u.json();
            let html='';
            (ud.users||[]).forEach(r=>{let actions=`<button class="btn-primary" style="font-size:10px" onclick="editUserPass(${r.id},'${r.username}')">Pass</button><button class="btn-delete" style="font-size:10px" onclick="deleteUser(${r.id})">Del</button><button class="btn-ban" style="font-size:10px" onclick="blockUserSession(${r.id},'${r.username}')">Kill</button>`;if(r.hwid)actions+=`<button class="btn-ban" style="font-size:10px" onclick="banUserHWID('${r.hwid}')">Ban HW</button>`;if(r.ip)actions+=`<button class="btn-ban" style="font-size:10px" onclick="banUserIP('${r.ip}')">Ban IP</button>`;html+=`<tr><td>${r.id}</td><td>${r.username}</td><td><code>${r.hwid||'N/A'}</code></td><td><code>${r.ip||'N/A'}</code></td><td>${r.last_login?new Date(r.last_login).toLocaleString('es-ES'):'Nunca'}</td><td>‚úÖ</td><td style="white-space:nowrap;font-size:10px">${actions}</td></tr>`});
            document.getElementById('usersTable').innerHTML=html||'<tr><td colspan="7">Sin usuarios</td></tr>';
        }else if(t==='version'){loadVersion();}
        else if(t==='banned'){
            const b=await fetch(`${API}/client/list_banned_ips/${currentOwnerID}?secret=${currentSecret}`);
            const bd=await b.json();
            let html='';
            (bd.banned_ips||[]).forEach(r=>{
                let tipo=r.hwid?'HWID':'IP';
                let valor=r.hwid||r.ip;
                html+=`<tr><td>${r.id}</td><td>${tipo}</td><td><code>${valor}</code></td><td>${r.reason}</td><td>${new Date(r.date).toLocaleString('es-ES')}</td><td><button class="btn-primary" style="font-size:10px" onclick="unbanItem(${r.id})">Desbanear</button></td></tr>`;
            });
            document.getElementById('bannedTable').innerHTML=html||'<tr><td colspan="6">Sin items baneados</td></tr>';
        }else if(t==='hwid_resets'){
            const h=await fetch(`${API}/admin/hwid_resets?owner_id=${currentOwnerID}&secret=${currentSecret}`);
            const hd=await h.json();
            let html='';
            (hd.resets||[]).forEach(r=>{
                html+=`<tr><td>${r.id}</td><td>${r.username}</td><td><code>${r.old_hwid||'N/A'}</code></td><td><button class="btn-primary" style="font-size:10px" onclick="approveHWIDReset(${r.id})">Aprobar</button><button class="btn-ban" style="font-size:10px" onclick="denyHWIDReset(${r.id})">Rechazar</button></td></tr>`;
            });
            document.getElementById('hwidResetsTable').innerHTML=html||'<tr><td colspan="4">Sin solicitudes pendientes</td></tr>';
        }
    }catch(e){msg('Error: '+e,false)}
}

function msg(m,ok=true){
    const d=document.getElementById('msg');
    d.textContent=m;
    d.className=`msg show ${ok?'success':'error'}`;
    setTimeout(()=>d.classList.remove('show'),3000);
}



async function delU(id){if(!confirm('¬øEliminar usuario?'))return;const r=await fetch(`${API}/admin/delete_user/${id}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({owner_id:currentOwnerID,secret:currentSecret})});const d=await r.json();msg(d.message||'Eliminado',d.success);if(d.success)loadTab('users')}

async function delL(id){if(!confirm('¬øEliminar licencia?'))return;const r=await fetch(`${API}/admin/delete_license/${id}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({owner_id:currentOwnerID,secret:currentSecret})});const d=await r.json();msg(d.message||'Eliminada',d.success);if(d.success)loadTab('licenses')}

async function blockUser(id){if(!confirm('¬øBloquear este usuario?'))return;const r=await fetch(`${API}/admin/block_user/${id}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({owner_id:currentOwnerID,secret:currentSecret})});const d=await r.json();msg(d.message||'Bloqueado',d.success);if(d.success)load()}

async function unblockUser(id){if(!confirm('¬øDesbloquear este usuario?'))return;const r=await fetch(`${API}/admin/unblock_user/${id}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({owner_id:currentOwnerID,secret:currentSecret})});const d=await r.json();msg(d.message||'Desbloqueado',d.success);if(d.success)load()}

async function createUser(){const u=document.getElementById('newUser').value;const p=document.getElementById('newPass').value;if(!u||!p){msg('Completa campos',false);return}if(u.length<3){msg('Usuario: m√≠nimo 3 caracteres',false);return}if(p.length<8){msg('Contrase√±a: m√≠nimo 8 caracteres',false);return}const r=await fetch(`${API}/client/create_user`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:p,owner_id:currentOwnerID,secret:currentSecret})});const d=await r.json();msg(d.message||'Creado',d.success);if(d.success){document.getElementById('newUser').value='';document.getElementById('newPass').value='';load()}}

async function genLic(){const r=await fetch(`${API}/admin/generate`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({owner_id:currentOwnerID,secret:currentSecret})});const d=await r.json();msg('Licencia: '+d.key,d.success);if(d.success)load()}

async function banIP(ip=null){const ipt=ip||document.getElementById('banIP').value;const reason=document.getElementById('banReason').value||'Sin raz√≥n';if(!ipt){msg('Ingresa IP',false);return}const r=await fetch(`${API}/admin/ban_ip`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({owner_id:currentOwnerID,secret:currentSecret,ip:ipt,reason})});const d=await r.json();msg(d.message||'Baneado',d.success);if(d.success){document.getElementById('banIP').value='';document.getElementById('banReason').value='';load()}}

async function banHWID(hwid=null){const hwidt=hwid||document.getElementById('banHWID').value;const reason=document.getElementById('banReason').value||'Sin raz√≥n';if(!hwidt){msg('Ingresa HWID',false);return}const r=await fetch(`${API}/admin/ban_hwid`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({owner_id:currentOwnerID,secret:currentSecret,hwid:hwidt,reason})});const d=await r.json();msg(d.message||'Baneado',d.success);if(d.success){document.getElementById('banHWID').value='';document.getElementById('banReason').value='';load()}}

async function banHWID_direct(hwid){if(!confirm('¬øBanear este HWID?'))return;const reason='Baneado desde usuario';await banHWID(hwid)}

async function unban(id){if(!confirm('¬øDesbanear?'))return;const r=await fetch(`${API}/admin/unban_ip/${id}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({owner_id:currentOwnerID,secret:currentSecret})});const d=await r.json();msg(d.message||'Desbaneado',d.success);if(d.success)load()}

async function doLogin(){const appName='OxcyShop_'+Math.random().toString(36).substring(7).toUpperCase();try{const r=await fetch(`${API}/dashboard/profile`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({app_name:appName,owner_id:'',secret:''})});const d=await r.json();if(d.success){currentUser='Admin';currentOwnerID=d.owner_id;currentAppName=d.app_name;currentSecret=d.secret;localStorage.setItem('dashSession',JSON.stringify({owner_id:d.owner_id,app_name:d.app_name,secret:d.secret}));document.getElementById('appTitle').textContent=currentAppName;document.getElementById('userDisplay').textContent=currentUser;document.getElementById('appDisplay').textContent=currentAppName;document.getElementById('ownerDisplay').textContent=currentOwnerID;document.getElementById('secretDisplay').textContent=currentSecret;document.getElementById('loginPanel').style.display='none';document.getElementById('dashPanel').style.display='block';load()}else{showLoginMsg('Error: '+d.message,false)}}catch(e){showLoginMsg('Error: '+e,false)}}

function doLogout(){currentUser='';currentOwnerID='';currentAppName='';currentSecret='';localStorage.removeItem('dashSession');showLogin()}

function restoreSession(){const session=localStorage.getItem('dashSession');if(session){try{const d=JSON.parse(session);currentUser='Admin';currentOwnerID=d.owner_id;currentAppName=d.app_name;currentSecret=d.secret;lastTab='creds';document.getElementById('appTitle').textContent=currentAppName;document.getElementById('userDisplay').textContent=currentUser;document.getElementById('appDisplay').textContent=currentAppName;document.getElementById('ownerDisplay').textContent=currentOwnerID;document.getElementById('secretDisplay').textContent=currentSecret;document.getElementById('loginPanel').style.display='none';document.getElementById('dashPanel').style.display='block'}catch(e){localStorage.removeItem('dashSession');showLogin()}}else{showLogin()}}

window.addEventListener('load',restoreSession);

function copyToClipboard(button,elementId){const element=document.getElementById(elementId);const text=element.textContent;if(!text||text==='-'){msg('Sin datos para copiar',false);return}navigator.clipboard.writeText(text).then(()=>{const original=button.textContent;button.textContent='‚úì Copiado';setTimeout(()=>{button.textContent=original},1500)}).catch(err=>{msg('Error: '+err,false)})}

function showLoginMsg(m,ok=true){const d=document.getElementById('loginMsg');d.textContent=m;d.className=`msg show ${ok?'success':'error'}`;setTimeout(()=>d.classList.remove('show'),3000)}

function showRegister(){document.getElementById('loginPanel').style.display='none';document.getElementById('registerPanel').style.display='block';document.getElementById('regUser').value='';document.getElementById('regPass').value='';document.getElementById('regMsg').textContent=''}

function showLogin(){document.getElementById('loginPanel').style.display='block';document.getElementById('dashPanel').style.display='none';document.getElementById('loginMsg').textContent=''}

async function doRegister(){const user=document.getElementById('regUser').value;const pass=document.getElementById('regPass').value;if(!user||!pass){showRegMsg('Completa los campos',false);return}try{const r=await fetch(`${API}/register`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:user,password:pass})});const d=await r.json();if(d.success){document.getElementById('newOwnerId').textContent=d.owner_id;document.getElementById('newSecret').textContent=d.secret;document.getElementById('newAppName').textContent=d.app_name;document.getElementById('registerPanel').style.display='none';document.getElementById('credsPanel').style.display='block'}else{showRegMsg(d.detail||'Error al registrarse',false)}}catch(e){showRegMsg('Error: '+e,false)}}

function showRegMsg(m,ok=true){const d=document.getElementById('regMsg');d.textContent=m;d.className=`msg show ${ok?'success':'error'}`;setTimeout(()=>d.classList.remove('show'),3000)}

async function resetHWID(id){if(!confirm('¬øResetear HWID? El usuario podr√° volver a loginear desde otra PC'))return;try{const r=await fetch(`${API}/admin/reset_hwid/${id}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({owner_id:currentOwnerID,secret:currentSecret})});const d=await r.json();msg(d.message||'HWID Reseteado',d.success);if(d.success)load()}catch(e){msg('Error: '+e,false)}}

async function loadVersion(){if(!currentOwnerID)return;try{const r=await fetch(`${API}/client/get_version/${currentOwnerID}?secret=${currentSecret}`);const d=await r.json();if(d.success){document.getElementById('currentVersionDisplay').textContent=d.version;document.getElementById('versionInput').value=d.version}}catch(e){msg('Error cargando versi√≥n: '+e,false)}}

async function setVersion(){const v=document.getElementById('versionInput').value;if(!v||!v.match(/^\d+(\.\d+)*$/)){msg('Versi√≥n inv√°lida',false);return}try{const r=await fetch(`${API}/client/set_version`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({version:v,owner_id:currentOwnerID,secret:currentSecret})});const d=await r.json();msg(d.message||'Versi√≥n actualizada',d.success);if(d.success)loadVersion()}catch(e){msg('Error: '+e,false)}}

async function deleteUser(userId){if(!confirm('¬øEliminar este usuario?'))return;try{const r=await fetch(`${API}/client/delete_user/${userId}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({owner_id:currentOwnerID,secret:currentSecret})});const d=await r.json();msg(d.message||'Eliminado',d.success);if(d.success)loadTab('users')}catch(e){msg('Error: '+e,false)}}

async function editUserPass(userId,username){const newPass=prompt(`Ingresa nueva contrase√±a para ${username}:`);if(!newPass)return;if(newPass.length<8){msg('Contrase√±a: m√≠nimo 8 caracteres',false);return}try{const r=await fetch(`${API}/client/update_user/${userId}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({owner_id:currentOwnerID,secret:currentSecret,password:newPass})});const d=await r.json();msg(d.message||'Contrase√±a actualizada',d.success);if(d.success)loadTab('users')}catch(e){msg('Error: '+e,false)}}

async function killSession(){const u=document.getElementById('killUsername').value;if(!u){msg('Ingresa username',false);return}if(!confirm(`¬øKill sesi√≥n de ${u}?`))return;try{const users=await fetch(`${API}/client/users/${currentOwnerID}?secret=${currentSecret}`);const ud=await users.json();const user=ud.users.find(x=>x.username===u);if(!user){msg('Usuario no encontrado',false);return}const r=await fetch(`${API}/client/block_user/${user.id}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({owner_id:currentOwnerID,secret:currentSecret})});const d=await r.json();msg(d.message||'Kill sesi√≥n enviado',d.success);if(d.success){document.getElementById('killUsername').value='';loadTab('users')}}catch(e){msg('Error: '+e,false)}}

async function banUserHWID(hwid){if(!confirm(`¬øBanear HWID ${hwid}?`))return;try{const r=await fetch(`${API}/client/ban_hwid`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({owner_id:currentOwnerID,secret:currentSecret,hwid:hwid,reason:'Baneado desde usuario'})});const d=await r.json();msg(d.message||'HWID baneado',d.success);if(d.success)loadTab('users')}catch(e){msg('Error: '+e,false)}}

async function banUserIP(ip){if(!confirm(`¬øBanear IP ${ip}?`))return;try{const r=await fetch(`${API}/client/ban_ip`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({owner_id:currentOwnerID,secret:currentSecret,ip:ip,reason:'Baneada desde usuario'})});const d=await r.json();msg(d.message||'IP baneada',d.success);if(d.success)loadTab('users')}catch(e){msg('Error: '+e,false)}}

async function blockUserSession(userId,username){if(!confirm(`¬øKill sesi√≥n de ${username}?`))return;try{const r=await fetch(`${API}/client/block_user/${userId}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({owner_id:currentOwnerID,secret:currentSecret})});const d=await r.json();msg(d.message||'Kill sesi√≥n enviado',d.success);if(d.success)loadTab('users')}catch(e){msg('Error: '+e,false)}}

async function unbanItem(banId){if(!confirm('¬øDesbanear este item?'))return;try{const r=await fetch(`${API}/client/unban_ip/${banId}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({owner_id:currentOwnerID,secret:currentSecret})});const d=await r.json();msg(d.message||'Desbaneado',d.success);if(d.success)loadTab('banned')}catch(e){msg('Error: '+e,false)}}

async function approveHWIDReset(userId){if(!confirm('¬øAprobar reset de HWID?'))return;try{const r=await fetch(`${API}/admin/approve_hwid_reset/${userId}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({owner_id:currentOwnerID,secret:currentSecret})});const d=await r.json();msg(d.message||'Reset aprobado',d.success);if(d.success)loadTab('hwid_resets')}catch(e){msg('Error: '+e,false)}}

async function denyHWIDReset(userId){if(!confirm('¬øRechazar reset de HWID?'))return;try{const r=await fetch(`${API}/admin/deny_hwid_reset/${userId}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({owner_id:currentOwnerID,secret:currentSecret})});const d=await r.json();msg(d.message||'Reset rechazado',d.success);if(d.success)loadTab('hwid_resets')}catch(e){msg('Error: '+e,false)}}

</script>

</body>
</html>
